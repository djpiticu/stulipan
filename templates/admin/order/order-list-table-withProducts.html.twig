{% extends 'admin/base_admin.html.twig' %}


{% block title %}
	{{ title }}
{% endblock %}


{% block stylesheets %}
    {{ parent() }}
{% endblock %}


{% block page_content %}
		
	{% block LISTA %}

        {{ include('/admin/_alert_widget.html.twig') }}

        <!-- page title -->
        {{ include('/admin/_title_widget.html.twig') }}


        <!-- header of default page content widget -->
        {{ include('/admin/_header_of_default_page_content.html.twig') }}

        <div class="row mb-2X">
            <div class="col-sm-6 col-lg-8">
                <div class="d-inline-block my-1 my-lg-0">

                    <!-- dateRange Widget -->
                    {{ include('/admin/dateRange-picker-widget.html.twig') }}
                </div>
                <div class="d-inline-block">
                    <a href="{{  path('order-list') }}" class="btn-link ml-1">Teljes lista</a>
                </div>
            </div>
            <div class="col-sm-6 col-lg-4">
                <div class="text-sm-right my-1 my-lg-0">
                    <a href="{{ path('boltzaras-edit') }}" class="btn btn-primary mb-2"><i class="fas fa-plus-circle mr-2"></i>Új rendelés</a>
                </div>
            </div>
        </div>




        <div class="table-responsive mb-3">
            <table class="table table-smX table-centeredX table-striped table-hover table-bordered mb-0" id="boltzaras-list">
                <thead class="thead-light">
				<tr>
                    <th scope="col">Rendelés</th>
                    <th scope="col">Vásárló</th>
				    <th scope="col">Címzett</th>
				    <th scope="col">Szállítási időpont</th>
                    <th scope="col">Fizetés</th>
                    <th scope="col" class="text-center">Állapot</th>
                    {#<th scope="col"><i class="fas fa-ellipsis-h"></i></th>#}
				  </tr>
			  </thead>
			  <tbody>
				{% if orders is defined %}
				{% for order in orders %}
				<tr>
                    <td class="text-nowrap">
                        <span class="text-sm">{{ order.createdAt|date('Y-m-d')}}</span><br>
                        <a href="{{ path('order-detail', {'id': order.id}) }}" class="font-weight-boldX">#{{ order.number|number_format(0, '', '') }}</a>
                    </td>
				    <td class="text-nowrapX">
                        <strong>{{ order.billingName ? order.billingName : '' }} {{ order.billingCompany is defined and order.billingCompany ? '/ ' ~ order.billingCompany : '' }}</strong> <br>
                        <div class="text-mutedZ">
                            +{{ order.billingPhone ? order.billingPhone : ''}} <br>
                            {% if order.billingAddress %}
                            {{ order.billingAddress.street }} <br>
                            <span class="text-sm">{{ order.billingAddress.zip }} {{ order.billingAddress.city }}</span> <br>
                            {% endif %}
                        </div>
                    </td>
				    <td class="text-nowrapX">
                        <strong>{{ order.shippingName ? order.shippingName : '' }}</strong> <br>
                        <div class="text-mutedZ">
                            +{{ order.shippingPhone ? order.shippingPhone : '' }} <br>
                            {% if order.shippingAddress %}
                            {{ order.shippingAddress.street }} <br>
                            <span class="text-sm">{{ order.shippingAddress.zip }} {{ order.shippingAddress.city }}</span> <br>
                            {% endif %}
                        </div>
                    </td>
				    <td class="text-nowrapX">
                        {% if order.deliveryDate %}
                            <i class="far fa-clock mr-1 text-muted"></i> <strong>{{ order.deliveryDate|date('Y M j.')|lower }}</strong> <br>
                            <span class="text-mutedZ">{{ order.deliveryInterval ? order.deliveryInterval ~ ' óra között': '' }}</span> <br>
                        {% endif %}
                        <span class="text-mutedZ text-sm">{{ order.shipping ? order.shipping.getName() : '' }}</span>
                    </td>
                    <td class="text-right text-nowrap">
                        <strong>{{ order.priceTotalAfterDiscount }} Ft</strong> <br>
                        {% if order.payment %}
                            {% if order.payment.image %}
                                <img class="img-thumbnail img-grayscaleX border-0 h-15px" src="{{ asset('/uploads/images/termekek/' ~ order.payment.image) }}" />
                            {% else %}
                                {{ order.payment ? order.payment.getName() : '' }} <br>
                            {% endif %}
                        {% endif %}

                    </td>
                    <td class="text-mutedZ" style="width: 25%;">
                        <span class="badge badge-warning text-uppercase">Függőben levő</span> <br>

                        <a href="#cardProductsDropdown{{ loop.index }}" data-toggle="collapse" class="dropdown-toggle text-underline mt-2" aria-expanded="false" aria-controls="cardProductsDropdown{{ loop.index }}">Termékek</a>

                        <div class="collapse" id="cardProductsDropdown{{ loop.index }}">
                            {% for item in order.items %}
                                <div class="rowX">
                                    <div class="text-nowrapX">
                                        <div class="d-flex">
                                            <a class="mr-1" href="{{ path('site-product-show', {'id': item.product.id}) }}" target="_blank">
                                                <img class="img-thumbnail rounded-circleX" src="{{ uploaded_asset(item.product.imagePath)|imagine_filter('product_thumbnail') }}" width="50px;" />
                                            </a>
                                            <div class="text-sm mb-1">
                                                {#Ár: {{ item.price|number_format(0, ',', ' ') }} Ft, #}
                                                <span class="text-muted">Menny.:</span> <em>{{ item.quantity }} db </em><br>
                                                <span class="text-muted">Összesen:</span> <em>{{ item.priceTotal|number_format(0, ',', ' ') }} Ft </em><br>
                                                <a href="{{ path('site-product-show', {'id': item.product.id}) }}" class="text-uppercaseX text-dark text-md"><strong>{{ item.product.productName }}</strong> <em><span class="badge badge-danger">{{ item.subproductAttribute ? '' ~ item.subproductAttribute : ''  }}</span></em></a><br>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                            <div class="rowX">
                                <div class="col-autoX text-nowrapX">
                                    {% if order.message %}
                                        <div class="text-sm">
                                            <div class="d-flex align-items-center text-center">
                                                <div class="d-flex align-items-start">
                                                    <div class="bg-light p-2">
                                                        <div class="">
                                                            <span><i class="far fa-envelope text-sm text-muted"></i></span>
                                                            {#<br>#}
                                                            {#<span class="d-block text-muted text-uppercase mt-1">Üzenet</span>#}
                                                        </div>
                                                    </div>
                                                    <div class="text-left ml-1">
                                                        <p class="text-sm mb-0">
                                                            <span><em>{{ order.message }}</em></span> <br>
                                                            <span>{{ order.messageAuthor }}</span> <br>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}

                                    {#<div class="d-flexX">#}
                                    {#{% if order.message %}#}
                                    {#<div class="order-message ml-1 mb-2">#}
                                    {#<p class="d-inline text-sm text-muted mb-0">#}
                                    {#<cite>{{ order.message }}</cite><br>#}
                                    {#{{ order.messageAuthor }} <br>#}
                                    {#</p>#}
                                    {#</div>#}
                                    {#{% endif %}#}
                                    {#</div>#}
                                </div>
                            </div>
                        </div>



                    </td>
				</tr>
				{% endfor %}
				{% else %}
				<tr>
			        <td><li><em>nincs rendelés</em></li></td>
			    </tr>
				{% endif %}
			  </tbody>
			</table>
		</div>
		<div class="pagerfanta">
                {% if paginator is defined %}
					{{ pagerfanta(paginator, 'twitter_bootstrap4') }}
                {% endif %}
		</div>

        <!-- footer of default page content widget -->
        {{ include('/admin/_footer_of_default_page_content.html.twig') }}

	{% endblock %}
{% endblock %}





{% block javascripts %}
    {{ parent() }}
    {#
     A dateRange-picker-widget.html.twig fajlban van hasznalva
 #}
    <script>
        $(function() {
            $('#JS--idosav input').daterangepicker({
                opens: 'right',
                autoApply: false,
                autoUpdateInput: false,
                locale: {
                    format: 'YYYY-MM-DD',
                    separator: ' / ',
                    applyLabel: 'Alkalmaz',
                    cancelLabel: 'Mégse',
                    daysOfWeek: [
                        'V',
                        'H',
                        'K',
                        'Sz',
                        'Cs',
                        'P',
                        'Sz'
                    ],
                    monthNames: [
                        'Január',
                        'Február',
                        'Március',
                        'Április',
                        'Május',
                        'Június',
                        'Július',
                        'Augusztus',
                        'Szeptember',
                        'Október',
                        'November',
                        'December'
                    ],
                    firstDay: 1,
                }
            });

            $('#JS--idosav input').on('apply.daterangepicker', function(ev, picker) {
                $(this).val(picker.startDate.format('YYYY-MM-DD') + ' / ' + picker.endDate.format('YYYY-MM-DD'));
            });

            $('#JS--idosav input').on('cancel.daterangepicker', function(ev, picker) {
                $(this).val('');
            });

        });
    </script>
{% endblock %}
        

